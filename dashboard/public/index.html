<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron City DNS Guard - Email Security Analysis</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-dark: #0f1419;
            --bg-card: #1a1f2e;
            --bg-input: #242938;
            --border: #2d3548;
            --gold: #d4af37;
            --gold-dark: #b8960c;
            --text: #e8e8e8;
            --text-muted: #8b949e;
            --critical: #ff4757;
            --high: #ff6b35;
            --medium: #ffa502;
            --low: #2ed573;
            --info: #54a0ff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            background: linear-gradient(135deg, var(--bg-card) 0%, #1e2538 100%);
            border-bottom: 2px solid var(--gold);
            padding: 20px 0;
            text-align: center;
        }
        .logo { font-size: 2rem; color: var(--gold); margin-bottom: 5px; }
        .subtitle { color: var(--text-muted); font-size: 0.9rem; letter-spacing: 2px; }
        
        .loading { text-align: center; padding: 60px 20px; }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .card-title {
            color: var(--gold);
            font-size: 1.1rem;
            margin-bottom: 16px;
        }
        
        .grade-section { text-align: center; padding: 40px 20px; }
        .grade-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 120px; height: 120px;
            border-radius: 50%;
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .grade-A, .grade-Aplus { background: linear-gradient(135deg, #2ed573, #1e8449); color: white; }
        .grade-B { background: linear-gradient(135deg, #54a0ff, #2980b9); color: white; }
        .grade-C { background: linear-gradient(135deg, #ffa502, #e67e22); color: white; }
        .grade-D { background: linear-gradient(135deg, #ff6b35, #d35400); color: white; }
        .grade-F { background: linear-gradient(135deg, #ff4757, #c0392b); color: white; }
        
        .domain-name { font-size: 1.5rem; color: var(--text); margin-bottom: 10px; }
        .scan-time { color: var(--text-muted); font-size: 0.85rem; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: var(--bg-input);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value { font-size: 2rem; font-weight: bold; color: var(--gold); }
        .stat-label { color: var(--text-muted); font-size: 0.85rem; margin-top: 5px; }
        
        .summary-box {
            background: linear-gradient(135deg, var(--bg-input), var(--bg-card));
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--gold);
            margin: 20px 0;
        }
        
        .quick-wins { list-style: none; }
        .quick-wins li {
            padding: 12px 15px;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .quick-wins li::before { content: "‚úì "; color: var(--gold); font-weight: bold; }
        
        .finding {
            background: var(--bg-input);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--medium);
        }
        .finding.critical { border-left-color: var(--critical); }
        .finding.high { border-left-color: var(--high); }
        .finding.medium { border-left-color: var(--medium); }
        .finding.low { border-left-color: var(--low); }
        .finding.info { border-left-color: var(--info); }
        
        .finding-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .finding-title { font-weight: 600; font-size: 1.1rem; }
        .severity-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .severity-badge.critical { background: var(--critical); }
        .severity-badge.high { background: var(--high); }
        .severity-badge.medium { background: var(--medium); color: #000; }
        .severity-badge.low { background: var(--low); color: #000; }
        
        .finding-detail { color: var(--text-muted); margin-bottom: 10px; }
        .finding-remediation {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }
        .finding-remediation strong { color: var(--gold); }
        .finding-impact { color: var(--text-muted); font-size: 0.9rem; margin-top: 10px; font-style: italic; }
        
        .email-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .email-item { background: var(--bg-input); padding: 15px; border-radius: 8px; }
        .email-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .email-item-name { font-weight: 600; }
        .email-status { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; }
        .email-status.valid { background: var(--low); color: #000; }
        .email-status.invalid { background: var(--critical); }
        .email-status.partial { background: var(--medium); color: #000; }
        
        .subdomain-list { max-height: 300px; overflow-y: auto; }
        .subdomain-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-input);
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .subdomain-name { font-family: monospace; font-size: 0.9rem; }
        .subdomain-ip { color: var(--text-muted); font-size: 0.8rem; }
        
        .no-data { text-align: center; padding: 60px 20px; color: var(--text-muted); }
        .no-data h2 { color: var(--gold); margin-bottom: 15px; }
        
        .cta-box {
            background: linear-gradient(135deg, var(--gold-dark), var(--gold));
            color: #000;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-top: 30px;
        }
        .cta-box h3 { font-size: 1.3rem; margin-bottom: 10px; }
        .cta-button {
            display: inline-block;
            background: #000;
            color: var(--gold);
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 15px;
        }
        
        .footer { text-align: center; padding: 30px; color: var(--text-muted); font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üõ°Ô∏è IRON CITY DNS GUARD</div>
        <div class="subtitle">EMAIL SECURITY ANALYSIS</div>
    </div>
    
    <div class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading your security analysis...</p>
        </div>
        
        <div id="no-data" class="no-data" style="display: none;">
            <h2>üîç No Scan Found</h2>
            <p>This scan may have expired or the link is invalid.</p>
            <p style="margin-top: 20px;">Want to run a new scan?</p>
            <a href="https://ironcityit.com/dns-guard" class="cta-button" style="margin-top: 15px; display: inline-block;">Run Free Scan</a>
        </div>
        
        <div id="results" style="display: none;">
            <div class="grade-section">
                <div id="grade-badge" class="grade-badge">-</div>
                <div id="domain-name" class="domain-name">-</div>
                <div id="scan-time" class="scan-time">-</div>
            </div>
            
            <div class="summary-box">
                <p id="executive-summary">-</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div id="stat-score" class="stat-value">-</div>
                    <div class="stat-label">Risk Score</div>
                </div>
                <div class="stat-box">
                    <div id="stat-records" class="stat-value">-</div>
                    <div class="stat-label">DNS Records</div>
                </div>
                <div class="stat-box">
                    <div id="stat-subdomains" class="stat-value">-</div>
                    <div class="stat-label">Subdomains</div>
                </div>
                <div class="stat-box">
                    <div id="stat-findings" class="stat-value">-</div>
                    <div class="stat-label">Issues Found</div>
                </div>
            </div>
            
            <div class="card" id="quick-wins-card">
                <div class="card-title">‚ö° Quick Wins - Fix These First</div>
                <ul id="quick-wins" class="quick-wins"></ul>
            </div>
            
            <div class="card">
                <div class="card-title">üìß Email Security Status</div>
                <div id="email-security" class="email-grid"></div>
            </div>
            
            <div class="card" id="findings-card">
                <div class="card-title">‚ö†Ô∏è Security Findings</div>
                <div id="findings"></div>
            </div>
            
            <div class="card" id="subdomains-card">
                <div class="card-title">üåê Discovered Subdomains</div>
                <div id="subdomains" class="subdomain-list"></div>
            </div>
            
            <div class="cta-box">
                <h3>Want Expert Help Fixing These Issues?</h3>
                <p>Our team can implement these security improvements for you.</p>
                <a href="https://ironcityit.com/contact" class="cta-button">Get a Free Consultation</a>
            </div>
        </div>
    </div>
    
    <div class="footer">¬© 2026 Iron City IT Advisors | Blue-Collar Security for Real Businesses</div>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBFkBj9FxSMxQeCBIagm3FpLsJeAjbS4Sc",
            authDomain: "icit-dnsguard.firebaseapp.com",
            projectId: "icit-dnsguard",
            storageBucket: "icit-dnsguard.firebasestorage.app",
            messagingSenderId: "47244786932",
            appId: "1:47244786932:web:162f413a4a4e0f2852f2a1"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const urlParams = new URLSearchParams(window.location.search);
        const scanId = urlParams.get('scan') || urlParams.get('id');
        
        async function loadScan() {
            const loadingEl = document.getElementById('loading');
            const noDataEl = document.getElementById('no-data');
            const resultsEl = document.getElementById('results');
            
            try {
                if (!scanId) {
                    loadingEl.style.display = 'none';
                    noDataEl.style.display = 'block';
                    return;
                }
                
                const doc = await db.collection('scans').doc(scanId).get();
                
                if (!doc.exists) {
                    loadingEl.style.display = 'none';
                    noDataEl.style.display = 'block';
                    return;
                }
                
                displayResults(doc.data());
                loadingEl.style.display = 'none';
                resultsEl.style.display = 'block';
                
            } catch (error) {
                console.error('Error:', error);
                loadingEl.style.display = 'none';
                noDataEl.innerHTML = '<h2>‚ö†Ô∏è Error</h2><p>' + error.message + '</p>';
                noDataEl.style.display = 'block';
            }
        }
        
        function displayResults(data) {
            const grade = data.email_security?.grade || 'F';
            const gradeBadge = document.getElementById('grade-badge');
            gradeBadge.textContent = grade;
            gradeBadge.className = 'grade-badge grade-' + (grade === 'A+' ? 'Aplus' : grade);
            
            document.getElementById('domain-name').textContent = data.domain || 'Unknown';
            document.getElementById('scan-time').textContent = 'Scanned: ' + 
                (data.scan_timestamp ? new Date(data.scan_timestamp).toLocaleString() : 'Unknown');
            
            document.getElementById('executive-summary').textContent = 
                data.executive_summary || 'Analysis complete.';
            
            document.getElementById('stat-score').textContent = (data.overall_risk_score || 0) + '/100';
            document.getElementById('stat-records').textContent = (data.records || []).length;
            document.getElementById('stat-subdomains').textContent = (data.subdomains || []).length;
            document.getElementById('stat-findings').textContent = (data.findings || []).length;
            
            // Quick Wins
            const quickWins = data.quick_wins || [];
            const quickWinsEl = document.getElementById('quick-wins');
            if (quickWins.length > 0) {
                quickWinsEl.innerHTML = quickWins.map(w => '<li>' + w + '</li>').join('');
            } else {
                document.getElementById('quick-wins-card').style.display = 'none';
            }
            
            // Email Security
            const es = data.email_security || {};
            document.getElementById('email-security').innerHTML = 
                '<div class="email-item"><div class="email-item-header"><span class="email-item-name">SPF</span>' +
                '<span class="email-status ' + (es.spf_valid ? 'valid' : 'invalid') + '">' + 
                (es.spf_valid ? '‚úì Valid' : '‚úó Missing') + '</span></div>' +
                '<div style="color:var(--text-muted);font-size:0.8rem">' + (es.spf_mechanism || 'Not configured') + '</div></div>' +
                
                '<div class="email-item"><div class="email-item-header"><span class="email-item-name">DKIM</span>' +
                '<span class="email-status ' + (es.dkim_configured ? 'valid' : 'invalid') + '">' +
                (es.dkim_configured ? '‚úì Found' : '‚úó Missing') + '</span></div>' +
                '<div style="color:var(--text-muted);font-size:0.8rem">' + 
                (es.dkim_selectors?.length ? 'Selectors: ' + es.dkim_selectors.join(', ') : 'No selectors') + '</div></div>' +
                
                '<div class="email-item"><div class="email-item-header"><span class="email-item-name">DMARC</span>' +
                '<span class="email-status ' + (es.dmarc_valid ? (es.dmarc_policy === 'reject' ? 'valid' : 'partial') : 'invalid') + '">' +
                (es.dmarc_valid ? 'Policy: ' + es.dmarc_policy : '‚úó Missing') + '</span></div></div>' +
                
                '<div class="email-item"><div class="email-item-header"><span class="email-item-name">DNSSEC</span>' +
                '<span class="email-status ' + (data.dnssec?.implemented ? 'valid' : 'invalid') + '">' +
                (data.dnssec?.implemented ? '‚úì Enabled' : '‚úó Disabled') + '</span></div></div>';
            
            // Findings
            const findings = data.findings || [];
            const findingsEl = document.getElementById('findings');
            if (findings.length > 0) {
                findingsEl.innerHTML = findings.map(f => 
                    '<div class="finding ' + f.severity + '">' +
                    '<div class="finding-header"><span class="finding-title">' + f.title + '</span>' +
                    '<span class="severity-badge ' + f.severity + '">' + f.severity + '</span></div>' +
                    '<div class="finding-detail">' + f.finding + '</div>' +
                    '<div class="finding-remediation"><strong>How to Fix:</strong> ' + f.remediation + '</div>' +
                    (f.business_impact ? '<div class="finding-impact">üí° ' + f.business_impact + '</div>' : '') +
                    '</div>'
                ).join('');
            } else {
                document.getElementById('findings-card').innerHTML = 
                    '<div class="card-title">‚úÖ No Security Issues</div><p style="color:var(--low)">Great! No issues found.</p>';
            }
            
            // Subdomains
            const subs = data.subdomains || [];
            const subsEl = document.getElementById('subdomains');
            if (subs.length > 0) {
                subsEl.innerHTML = subs.slice(0, 20).map(s => 
                    '<div class="subdomain-item"><span class="subdomain-name">' + s.subdomain + '</span>' +
                    '<span class="subdomain-ip">' + (s.ip_addresses?.join(', ') || s.cnames?.join(', ') || 'N/A') + '</span></div>'
                ).join('') + (subs.length > 20 ? '<p style="color:var(--text-muted);text-align:center;padding:10px">+ ' + (subs.length - 20) + ' more</p>' : '');
            } else {
                document.getElementById('subdomains-card').style.display = 'none';
            }
        }
        
        loadScan();
    </script>
</body>
</html>
