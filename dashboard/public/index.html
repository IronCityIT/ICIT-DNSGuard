<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iron City DNS Guard - DNS Security Intelligence</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--gold:#D4AF37;--gold-dark:#b8960c;--dark:#0a0a14;--card:#12121f;--card-lighter:#1a1a2e;--border:#2a2a3e;--text:#fff;--muted:#8b949e;--critical:#ff006e;--high:#ff4757;--medium:#ffa502;--low:#2ed573;--info:#54a0ff;--purple:#9d4edd}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:var(--dark);color:var(--text);min-height:100vh;line-height:1.6}
.container{max-width:1400px;margin:0 auto;padding:0 24px}

/* Header */
.header{background:linear-gradient(135deg,#0d0d1a 0%,#1a1a2e 100%);border-bottom:2px solid var(--gold);padding:20px 0;position:sticky;top:0;z-index:100}
.header-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px}
.logo-section{display:flex;align-items:center;gap:20px}
.logo{width:70px;height:70px;border-radius:12px;border:2px solid var(--gold);object-fit:cover}
.brand h1{font-size:1.5rem;font-weight:700;letter-spacing:1px}
.brand .highlight{color:var(--gold)}
.brand .subtitle{color:var(--muted);font-size:.75rem;letter-spacing:3px;margin-top:4px}
.header-stats{display:flex;gap:20px}
.header-stat{text-align:center;padding:12px 20px;background:rgba(212,175,55,.08);border-radius:10px;border:1px solid rgba(212,175,55,.2)}
.header-stat-value{font-size:1.6rem;font-weight:700;color:var(--gold)}
.header-stat-label{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px}

/* Executive Summary */
.exec-summary{background:linear-gradient(135deg,var(--card) 0%,var(--card-lighter) 100%);border:1px solid var(--border);border-radius:16px;padding:32px;margin:30px 0}
.exec-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px}
.exec-title{font-size:1.4rem;color:var(--gold)}
.exec-badge{background:linear-gradient(135deg,var(--gold),var(--gold-dark));color:#000;padding:6px 16px;border-radius:20px;font-size:.75rem;font-weight:600}
.exec-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px}
.exec-card{background:rgba(0,0,0,.3);border-radius:12px;padding:24px;border:1px solid var(--border)}
.exec-card h4{color:var(--gold);margin-bottom:12px;font-size:.95rem}
.exec-card p{color:var(--muted);font-size:.9rem;line-height:1.7}
.exec-card .highlight{color:var(--text);font-weight:500}

/* Risk Score */
.risk-score-container{display:flex;justify-content:center;align-items:center;height:100%}
.risk-score{width:130px;height:130px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:700;position:relative}
.risk-score::before{content:'';position:absolute;inset:-4px;border-radius:50%;background:conic-gradient(var(--gold) 0deg,transparent 0deg);opacity:.3}
.risk-score.excellent{background:linear-gradient(135deg,#1a472a,#2d5a3d);border:3px solid var(--low)}
.risk-score.good{background:linear-gradient(135deg,#2d4a1a,#3d5a2d);border:3px solid #7bed9f}
.risk-score.medium{background:linear-gradient(135deg,#4a3a1a,#5a4a2d);border:3px solid var(--medium)}
.risk-score.poor{background:linear-gradient(135deg,#4a1a1a,#5a2d2d);border:3px solid var(--high)}
.risk-score.critical{background:linear-gradient(135deg,#4a0a1a,#5a1d2d);border:3px solid var(--critical)}
.risk-score-value{font-size:2.2rem}
.risk-score-label{font-size:.7rem;color:var(--muted);margin-top:4px}

/* Stats Grid */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin:30px 0}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px;text-align:center;transition:transform .2s,border-color .2s}
.stat-card:hover{transform:translateY(-3px);border-color:var(--gold)}
.stat-icon{font-size:2rem;margin-bottom:12px}
.stat-value{font-size:2rem;font-weight:700;color:var(--gold)}
.stat-label{font-size:.8rem;color:var(--muted);margin-top:8px}

/* Findings Section */
.section{margin:30px 0}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px}
.section-title{font-size:1.2rem;color:var(--text);display:flex;align-items:center;gap:10px}
.section-title span{color:var(--gold)}

/* Findings Table */
.findings-table{width:100%;border-collapse:separate;border-spacing:0;background:var(--card);border-radius:12px;overflow:hidden;border:1px solid var(--border)}
.findings-table th{background:rgba(212,175,55,.1);color:var(--gold);font-weight:600;text-align:left;padding:16px 20px;font-size:.8rem;text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid var(--border)}
.findings-table td{padding:16px 20px;border-bottom:1px solid var(--border);font-size:.9rem}
.findings-table tr:last-child td{border-bottom:none}
.findings-table tr:hover{background:rgba(212,175,55,.03)}

/* Severity Badges */
.severity{display:inline-block;padding:4px 12px;border-radius:20px;font-size:.75rem;font-weight:600}
.severity-critical{background:rgba(255,0,110,.2);color:var(--critical)}
.severity-high{background:rgba(255,71,87,.2);color:var(--high)}
.severity-medium{background:rgba(255,165,2,.2);color:var(--medium)}
.severity-low{background:rgba(46,213,115,.2);color:var(--low)}
.severity-info{background:rgba(84,160,255,.2);color:var(--info)}

/* Grade Badge */
.grade-badge{display:inline-flex;align-items:center;justify-content:center;width:50px;height:50px;border-radius:10px;font-size:1.4rem;font-weight:700}
.grade-A{background:linear-gradient(135deg,var(--low),#1e7d4e);color:#fff}
.grade-B{background:linear-gradient(135deg,#7bed9f,#2ed573);color:#000}
.grade-C{background:linear-gradient(135deg,var(--medium),#cc8400);color:#000}
.grade-D{background:linear-gradient(135deg,var(--high),#cc4400);color:#fff}
.grade-F{background:linear-gradient(135deg,var(--critical),#cc1f2d);color:#fff}

/* Charts */
.charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:24px;margin:30px 0}
.chart-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:24px}
.chart-card h3{color:var(--gold);margin-bottom:20px;font-size:1rem}

/* Scan History */
.scan-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px;transition:border-color .2s}
.scan-card:hover{border-color:var(--gold)}
.scan-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.scan-domain{font-size:1.1rem;font-weight:600;color:var(--text)}
.scan-time{font-size:.8rem;color:var(--muted)}
.scan-stats{display:flex;gap:20px;flex-wrap:wrap}
.scan-stat{display:flex;align-items:center;gap:8px}
.scan-stat-label{font-size:.8rem;color:var(--muted)}
.scan-stat-value{font-weight:600}

/* Loading State */
.loading{text-align:center;padding:60px 20px}
.loading-spinner{width:50px;height:50px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 20px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Empty State */
.empty-state{text-align:center;padding:60px 20px;color:var(--muted)}
.empty-state-icon{font-size:4rem;margin-bottom:20px;opacity:.5}
.empty-state h3{color:var(--text);margin-bottom:12px}

/* Footer */
.footer{background:var(--card);border-top:1px solid var(--border);padding:30px 0;margin-top:50px;text-align:center}
.footer p{color:var(--muted);font-size:.85rem}
.footer a{color:var(--gold);text-decoration:none}

/* Responsive */
@media(max-width:768px){
.header-content{flex-direction:column;text-align:center}
.header-stats{justify-content:center}
.exec-grid{grid-template-columns:1fr}
.charts-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header class="header">
<div class="container">
<div class="header-content">
<div class="logo-section">
<img src="assets/logo.jpg" alt="DNS Guard" class="logo">
<div class="brand">
<h1>IRON CITY <span class="highlight">DNS GUARD</span></h1>
<p class="subtitle">DNS SECURITY INTELLIGENCE</p>
</div>
</div>
<div class="header-stats">
<div class="header-stat">
<div class="header-stat-value" id="total-scans">--</div>
<div class="header-stat-label">Assessments</div>
</div>
<div class="header-stat">
<div class="header-stat-value" id="total-domains">--</div>
<div class="header-stat-label">Domains</div>
</div>
<div class="header-stat">
<div class="header-stat-value" id="total-findings">--</div>
<div class="header-stat-label">Findings</div>
</div>
</div>
</div>
</div>
</header>

<main class="container">

<!-- Executive Summary -->
<section class="exec-summary">
<div class="exec-header">
<h2 class="exec-title">üìã Executive Summary</h2>
<span class="exec-badge">DNS Security Assessment</span>
</div>
<div class="exec-grid">
<div class="exec-card">
<h4>üéØ Assessment Overview</h4>
<p>Comprehensive DNS security analysis covering <span class="highlight">email authentication</span> (SPF, DKIM, DMARC), <span class="highlight">DNSSEC validation</span>, <span class="highlight">threat intelligence</span> correlation, and <span class="highlight">configuration best practices</span>.</p>
</div>
<div class="exec-card">
<h4>üîç Analysis Scope</h4>
<p>Multi-layer DNS inspection including <span class="highlight">record anomaly detection</span>, <span class="highlight">subdomain enumeration</span>, <span class="highlight">IP reputation checks</span>, and compliance mapping to <span class="highlight">NIST</span>, <span class="highlight">CIS Controls</span>, and industry standards.</p>
</div>
<div class="exec-card">
<div class="risk-score-container">
<div class="risk-score medium" id="risk-score">
<span class="risk-score-value" id="risk-grade">--</span>
<span class="risk-score-label">Email Security</span>
</div>
</div>
</div>
<div class="exec-card">
<h4>üí° Key Recommendations</h4>
<p id="recommendations-text">Loading recommendations...</p>
</div>
</div>
</section>

<!-- Stats Grid -->
<section class="stats-grid">
<div class="stat-card">
<div class="stat-icon">üìß</div>
<div class="stat-value" id="spf-status">--</div>
<div class="stat-label">SPF Status</div>
</div>
<div class="stat-card">
<div class="stat-icon">üîê</div>
<div class="stat-value" id="dkim-status">--</div>
<div class="stat-label">DKIM Status</div>
</div>
<div class="stat-card">
<div class="stat-icon">üõ°Ô∏è</div>
<div class="stat-value" id="dmarc-status">--</div>
<div class="stat-label">DMARC Policy</div>
</div>
<div class="stat-card">
<div class="stat-icon">üîí</div>
<div class="stat-value" id="dnssec-status">--</div>
<div class="stat-label">DNSSEC</div>
</div>
<div class="stat-card">
<div class="stat-icon">üåê</div>
<div class="stat-value" id="subdomain-count">--</div>
<div class="stat-label">Subdomains</div>
</div>
<div class="stat-card">
<div class="stat-icon">‚ö†Ô∏è</div>
<div class="stat-value" id="threat-count">--</div>
<div class="stat-label">Threat Indicators</div>
</div>
</section>

<!-- Charts -->
<section class="charts-grid">
<div class="chart-card">
<h3>üìä Finding Severity Distribution</h3>
<canvas id="severityChart"></canvas>
</div>
<div class="chart-card">
<h3>üìà Security Score Trend</h3>
<canvas id="trendChart"></canvas>
</div>
</section>

<!-- Recent Findings -->
<section class="section">
<div class="section-header">
<h2 class="section-title">‚ö†Ô∏è <span>Security Findings</span></h2>
</div>
<table class="findings-table">
<thead>
<tr>
<th>Severity</th>
<th>Category</th>
<th>Finding</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody id="findings-body">
<tr><td colspan="4" class="loading"><div class="loading-spinner"></div>Loading findings...</td></tr>
</tbody>
</table>
</section>

<!-- Recent Scans -->
<section class="section">
<div class="section-header">
<h2 class="section-title">üïê <span>Recent Assessments</span></h2>
</div>
<div id="scans-list">
<div class="loading"><div class="loading-spinner"></div>Loading scan history...</div>
</div>
</section>

</main>

<footer class="footer">
<div class="container">
<p>¬© 2025 <a href="https://ironcityit.com" target="_blank">Iron City IT Advisors</a> | DNS Guard - DNS Security Intelligence Platform</p>
<p style="margin-top:8px;font-size:.75rem">Blue-Collar Security for Real-World Protection</p>
</div>
</footer>

<script>
// Firebase Configuration - UPDATE WITH REAL VALUES
const firebaseConfig = {
  apiKey: "AIzaSyDNSGuardKeyHere",
  authDomain: "icit-dnsguard.firebaseapp.com",
  projectId: "icit-dnsguard",
  storageBucket: "icit-dnsguard.appspot.com",
  messagingSenderId: "000000000000",
  appId: "1:000000000000:web:0000000000000000"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Charts
let severityChart, trendChart;

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  initCharts();
  loadDashboardData();
});

function initCharts() {
  const severityCtx = document.getElementById('severityChart').getContext('2d');
  severityChart = new Chart(severityCtx, {
    type: 'doughnut',
    data: {
      labels: ['Critical', 'High', 'Medium', 'Low', 'Info'],
      datasets: [{
        data: [0, 0, 0, 0, 0],
        backgroundColor: ['#ff006e', '#ff4757', '#ffa502', '#2ed573', '#54a0ff'],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom', labels: { color: '#8b949e', padding: 20 } } }
    }
  });

  const trendCtx = document.getElementById('trendChart').getContext('2d');
  trendChart = new Chart(trendCtx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Security Score',
        data: [],
        borderColor: '#D4AF37',
        backgroundColor: 'rgba(212,175,55,0.1)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { min: 0, max: 100, grid: { color: '#2a2a3e' }, ticks: { color: '#8b949e' } },
        x: { grid: { color: '#2a2a3e' }, ticks: { color: '#8b949e' } }
      },
      plugins: { legend: { display: false } }
    }
  });
}

async function loadDashboardData() {
  try {
    const scansSnapshot = await db.collection('scans').orderBy('timestamp', 'desc').limit(20).get();
    
    if (scansSnapshot.empty) {
      showEmptyState();
      return;
    }

    const scans = [];
    scansSnapshot.forEach(doc => scans.push({ id: doc.id, ...doc.data() }));
    updateDashboard(scans);
    
  } catch (error) {
    console.error('Error loading data:', error);
    showEmptyState();
  }
}

function updateDashboard(scans) {
  const latestScan = scans[0];
  
  document.getElementById('total-scans').textContent = scans.length;
  document.getElementById('total-domains').textContent = new Set(scans.map(s => s.domain)).size;
  
  let totalFindings = 0, critical = 0, high = 0, medium = 0, low = 0, info = 0;
  
  scans.forEach(scan => {
    if (scan.findings) {
      scan.findings.forEach(f => {
        totalFindings++;
        if (f.severity === 'critical') critical++;
        else if (f.severity === 'high') high++;
        else if (f.severity === 'medium') medium++;
        else if (f.severity === 'low') low++;
        else info++;
      });
    }
  });
  
  document.getElementById('total-findings').textContent = totalFindings;
  
  if (latestScan.email_security) {
    const es = latestScan.email_security;
    document.getElementById('risk-grade').textContent = es.grade || '--';
    document.getElementById('spf-status').textContent = es.spf_status === 'valid' ? '‚úÖ' : '‚ö†Ô∏è';
    document.getElementById('dkim-status').textContent = es.dkim_status === 'configured' ? '‚úÖ' : '‚ö†Ô∏è';
    document.getElementById('dmarc-status').textContent = es.dmarc_policy || 'none';
    
    const riskEl = document.getElementById('risk-score');
    riskEl.className = 'risk-score ' + getGradeClass(es.grade || 'F');
  }
  
  document.getElementById('dnssec-status').textContent = latestScan.dnssec?.implemented ? '‚úÖ' : '‚ùå';
  document.getElementById('subdomain-count').textContent = latestScan.subdomains?.length || 0;
  document.getElementById('threat-count').textContent = latestScan.threat_intel?.filter(t => t.is_malicious).length || 0;
  
  if (latestScan.recommendations?.length > 0) {
    document.getElementById('recommendations-text').innerHTML = 
      latestScan.recommendations.slice(0, 3).map(r => `<span class="highlight">‚Ä¢ ${r}</span>`).join('<br>');
  } else {
    document.getElementById('recommendations-text').textContent = 'No critical recommendations at this time.';
  }
  
  severityChart.data.datasets[0].data = [critical, high, medium, low, info];
  severityChart.update();
  
  const trendData = scans.slice(0, 10).reverse();
  trendChart.data.labels = trendData.map(s => new Date(s.timestamp?.toDate?.() || s.timestamp).toLocaleDateString());
  trendChart.data.datasets[0].data = trendData.map(s => s.overall_risk_score || 50);
  trendChart.update();
  
  renderFindings(scans);
  renderScans(scans);
}

function renderFindings(scans) {
  const tbody = document.getElementById('findings-body');
  const allFindings = [];
  
  scans.forEach(scan => {
    if (scan.findings) scan.findings.forEach(f => allFindings.push({ ...f, domain: scan.domain }));
  });
  
  if (allFindings.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="empty-state"><div class="empty-state-icon">üéâ</div><h3>No findings</h3><p>All domains are configured securely!</p></td></tr>';
    return;
  }
  
  const severityOrder = { critical: 0, high: 1, medium: 2, low: 3, info: 4 };
  allFindings.sort((a, b) => (severityOrder[a.severity] || 4) - (severityOrder[b.severity] || 4));
  
  tbody.innerHTML = allFindings.slice(0, 15).map(f => `
    <tr>
      <td><span class="severity severity-${f.severity}">${f.severity?.toUpperCase() || 'INFO'}</span></td>
      <td>${f.category || 'General'}</td>
      <td>${f.finding || f.description || 'N/A'}</td>
      <td>${f.recommendation || '-'}</td>
    </tr>
  `).join('');
}

function renderScans(scans) {
  const container = document.getElementById('scans-list');
  
  container.innerHTML = scans.slice(0, 10).map(scan => {
    const timestamp = scan.timestamp?.toDate?.() || new Date(scan.timestamp);
    const grade = scan.email_security?.grade || '?';
    
    return `
      <div class="scan-card">
        <div class="scan-header">
          <span class="scan-domain">${scan.domain || 'Unknown'}</span>
          <span class="scan-time">${timestamp.toLocaleString()}</span>
        </div>
        <div class="scan-stats">
          <div class="scan-stat"><span class="grade-badge grade-${grade.charAt(0)}">${grade}</span></div>
          <div class="scan-stat"><span class="scan-stat-label">Score:</span><span class="scan-stat-value">${scan.overall_risk_score || '--'}/100</span></div>
          <div class="scan-stat"><span class="scan-stat-label">Records:</span><span class="scan-stat-value">${scan.records?.length || 0}</span></div>
          <div class="scan-stat"><span class="scan-stat-label">Subdomains:</span><span class="scan-stat-value">${scan.subdomains?.length || 0}</span></div>
          <div class="scan-stat"><span class="scan-stat-label">Findings:</span><span class="scan-stat-value">${scan.findings?.length || 0}</span></div>
        </div>
      </div>
    `;
  }).join('');
}

function getGradeClass(grade) {
  const g = grade?.charAt(0) || 'F';
  if (g === 'A') return 'excellent';
  if (g === 'B') return 'good';
  if (g === 'C') return 'medium';
  if (g === 'D') return 'poor';
  return 'critical';
}

function showEmptyState() {
  document.getElementById('total-scans').textContent = '0';
  document.getElementById('total-domains').textContent = '0';
  document.getElementById('total-findings').textContent = '0';
  document.getElementById('risk-grade').textContent = '--';
  document.getElementById('spf-status').textContent = '--';
  document.getElementById('dkim-status').textContent = '--';
  document.getElementById('dmarc-status').textContent = '--';
  document.getElementById('dnssec-status').textContent = '--';
  document.getElementById('subdomain-count').textContent = '0';
  document.getElementById('threat-count').textContent = '0';
  document.getElementById('recommendations-text').textContent = 'Run your first DNS security assessment from the Command Center at portal.ironcityit.com';
  
  document.getElementById('findings-body').innerHTML = '<tr><td colspan="4" class="empty-state"><div class="empty-state-icon">üìã</div><h3>No findings yet</h3><p>Run your first scan from the Command Center</p></td></tr>';
  document.getElementById('scans-list').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><h3>No assessments yet</h3><p>Start a DNS security assessment from <a href="https://portal.ironcityit.com" style="color:var(--gold)">portal.ironcityit.com</a></p></div>';
}
</script>

</body>
</html>
